DROP TABLE IF EXISTS ratings;
DROP TABLE IF EXISTS users;
DROP TABLE IF EXISTS movies;

CREATE TABLE users (
  user_id INTEGER PRIMARY KEY,
  name TEXT NOT NULL UNIQUE
);

CREATE TABLE movies (
  movie_id INTEGER PRIMARY KEY,
  title TEXT NOT NULL UNIQUE,
  release_year INTEGER
);

CREATE TABLE ratings (
  user_id INTEGER NOT NULL,
  movie_id INTEGER NOT NULL,
  rating INTEGER NULL,
  rated_at TEXT DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (user_id, movie_id),
  FOREIGN KEY (user_id) REFERENCES users(user_id),
  FOREIGN KEY (movie_id) REFERENCES movies(movie_id),
  CHECK (rating IS NULL OR (rating BETWEEN 1 AND 5))
);

INSERT INTO movies (movie_id, title, release_year) VALUES
  (1, 'Dune: Part Two', 2024),
  (2, 'Oppenheimer', 2023),
  (3, 'Barbie', 2023),
  (4, 'Spider-Man: Across the Spider-Verse', 2023),
  (5, 'Poor Things', 2023),
  (6, 'The Batman', 2022);

INSERT INTO users (user_id, name) VALUES
  (1, 'Izza'),
  (2, 'Araf'),
  (3, 'Iqrra'),
  (4, 'Sara'),
  (5, 'Hassan'),
  (6, 'Noor');

INSERT INTO ratings (user_id, movie_id, rating) VALUES
  (1,1,5),(1,2,4),(1,3,4),(1,4,NULL),(1,5,3),(1,6,4),
  (2,1,4),(2,2,5),(2,3,NULL),(2,4,5),(2,5,NULL),(2,6,4),
  (3,1,5),(3,2,4),(3,3,5),(3,4,4),(3,5,4),(3,6,NULL),
  (4,1,NULL),(4,2,5),(4,3,4),(4,4,4),(4,5,3),(4,6,4),
  (5,1,4),(5,2,NULL),(5,3,3),(5,4,5),(5,5,4),(5,6,5),
  (6,1,3),(6,2,4),(6,3,NULL),(6,4,4),(6,5,5),(6,6,NULL);
